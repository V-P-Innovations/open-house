<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Chá de Casa Nova</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Lista de Chá de Casa Nova</h1>
    
    <!-- Formulário para o usuário master adicionar itens -->
    <div id="masterSection">
        <h2>Adicionar Item à Lista</h2>
        <input type="text" id="newItem" placeholder="Nome do item" />
        <button onclick="addItem()">Adicionar</button>
    </div>

    <!-- Campo para o usuário padrão colocar o nome -->
    <div id="userSection">
        <h2>Marque um Item</h2>
        <input type="text" id="userName" placeholder="Seu nome" />
        <ul id="giftList"></ul>
    </div>

    <script>
        // Função para adicionar um item
        async function addItem() {
            const newItem = document.getElementById('newItem').value;
            if (!newItem) return;

            const response = await fetch('http://localhost:3000/add-item', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: newItem })
            });
            
            const data = await response.json();
            document.getElementById('newItem').value = ''; // Limpa o campo
            fetchItems(); // Atualiza a lista
        }

        // Função para buscar todos os itens
        async function fetchItems() {
            const response = await fetch('http://localhost:3000/items');
            const items = await response.json();
            renderItems(items);
        }

        // Renderiza a lista de itens no front-end
        function renderItems(items) {
            const giftList = document.getElementById('giftList');
            giftList.innerHTML = ''; // Limpa a lista antes de renderizar

            items.forEach(item => {
                const li = document.createElement('li');

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `item${item.id}`;
                checkbox.disabled = item.selected_by !== null;
                checkbox.checked = item.selected_by !== null;
                checkbox.addEventListener('change', () => selectItem(item.id));

                const label = document.createElement('label');
                label.htmlFor = `item${item.id}`;
                label.textContent = `${item.name} - ${item.selected_by ? 'Escolhido por: ' + item.selected_by : ''}`;

                li.appendChild(checkbox);
                li.appendChild(label);
                giftList.appendChild(li);
            });
        }

        // Função para selecionar um item
        async function selectItem(id) {
            const userName = document.getElementById('userName').value;
            if (!userName) {
                alert('Por favor, insira seu nome antes de escolher um item.');
                return;
            }

            const response = await fetch('http://localhost:3000/select-item', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id, selectedBy: userName })
            });

            fetchItems(); // Atualiza a lista após a seleção
        }

        // Carregar os itens ao carregar a página
        document.addEventListener('DOMContentLoaded', fetchItems);
    </script>
</body>
</html>
